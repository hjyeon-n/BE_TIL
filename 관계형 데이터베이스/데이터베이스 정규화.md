# 데이터베이스 정규화 🐱‍💻

데이터베이스 설계과정에서 논리적 설계단계에서는 **데이터의 중복을 제거**하는 것이 중요한 목표 중의 하나이다. 데이터 중복의 제거는 테이블의 분해를 통해서 이루어지며, 이를 위해 **함수적 종속**과 **정규화 이론**에 대한 이해가 필요하다.

<br>

### 함수적 종속 🙄

무결성 제약의 한 종류로서, 키의 개념을 일반화한 것이다. 함수적 종속은 하나의 테이블 내에서 필드들 간의 관계로 정의된다.

> 테이블 R에서 X와 Y를 각각 R에서 정의된 필드들의 부분 집합이라고 하자. 이때 X의 값이 동일한 임의의 레코드의 쌍인 t1과 t2에 대해서 Y의 값도 동일하다면 **Y는 X에 함수적 종속된다**고 말한다. 표기는 **X → Y**

이 때 X는 Y를 함수적으로 결정한다고도 해석할 수 있다. X를 **결정자(determinant)**, Y를 **종속자(dependent)**라고 한다.

<br>

#### 함수적 종속의 특성 

- **포함 규칙**

  테이블 R에서 필드 집합 X, Y가 있다고 가정하자. 이때 **X ⊂Y이면 X → Y가 항상 만족**한다.



- **분해 규칙**

  테이블 R에서 집합 X, Y, Z가 있다고 가정하자. 이때 **X→(Y, Z)이면, X→Y, X→Z가 항상 성립**한다.



- **합성 규칙**

  테이블 R에서 필드 집합 X, Y, Z가 있다고 가정하자. 이때 **X→Y와 X→Z가 성립하면 X→(Y, Z)도 성립**한다.



- **이행 규칙**

  테이블 R에서 필드 집합 X, Y, Z가 있다고 가정하자. 이때 **X→Y이고 Y→Z이면, X→Z가 항상 성립**한다.

<br>

#### 키와 함수적 종속의 관계

테이블 R에서 필드K가 수퍼키이면, K→R이 성립한다. (R은 테이블 R에 포함된 모든 필드들의 집합)

<br>

### 이상현상 (Anomaly) 😵

📌 예시 테이블 {stu_id, dept_id, dept_name, office} 기본키: stu_id

- #### 삽입 이상

  > 데이터를 저장하려고 할 때 저장할 수 없거나 원하지 않는 데이터를 삽입해야만 하는 현상

  ex 🗨) '물리학과'의 office가 '300호'라는 레코드를 삽입하려고 한다. 하지만 학생이 결정되지 않으면 stu_id에 Null값을 삽입해야 하는데, stu_id는 기본키이므로 가상의 학번을 임의로 생성해서 삽입해야 한다.



- #### 삭제 이상

  > 하나의 데이터를 삭제할 경우 삭제되지 말아야 할 정보까지 동시에 삭제되는 현상

  ex 🗨) '전자공학과'에 학번이 '1292'인 학생 한 명만 존재한다고 가정하자. 이때 이 학생의 데이터를 지우기 위해서는 '전자공학과'의 정보도 함께 삭제 된다.



- #### 수정 이상 (갱신 이상)

  > 중복된 정보의 일부만을 수정하여 정보의 불일치가 발생하는 현상

  ex 🗨) '컴퓨터공학과'의 사무실이 '201호'에서 '211'호로 변경되었을 때 모든 '컴퓨터공학과'의 학생들의 레코드에 대해서 office 필드값을 수정해야 한다.

<br>

### 정규형(normal form) 🛠

단계별 정규화 과정을 통해 분해된 테이블들을 말한다.

![image](https://user-images.githubusercontent.com/62419307/89853255-e5e42680-dbcb-11ea-9cf8-4c103f51aa72.png)

- #### 1차 정규형

  > 테이블 R에 속한 모든 도메인이 원자값만으로 구성되어 있다면 R은 1차 정규형

  따라서 관계형 데이터 모델의 정의를 따르는 모든 테이블들은 1차 정규형이라고 할 수 있다.



- #### 2차 정규형

  1차 정규형은 함수적 종속 중에서 키에 포함되지 않은 필드가 키의 부분 집합에 의해 함수적으로 결정해서 이상현상이 발생한다.

  <br>

  📌 예시 테이블 {stu_id, title, dept_name, office, grade} 기본키: (stu_id, title)

  - 삽입 이상: 학번이 '1292'인 학생이 '전자공학과'에 소속된다는 사실을 삽입하려면 최소한 그 학생이 하나의 과목을 수강해야만 한다.
  - 삭제 이상: 학번이 '1293'인 학생이 '자료구조'를 수강한다는 사실을 삭제하면 이 학생이 속하는 과 정보도 삭제 된다.
  - 수정 이상: 학번이 '1294'인 학생이 과를 바꾼다고 하면, 이를 모든 레코드에 대해서 반영해야 한다.

  <br>

  🤷‍♀️ 이런 문제가 발생하는 이유❓

  dept_name이 기본키인 (stu_id, title) 중에서 stu_id에 의해서만 결정된다. 이와 같이 키에 포함되지 않은 필드가 키의 부분집합에 종속되는 것을 **부분 종속**이라고 한다.

  <br>

  🙋‍♀️그러면 어떻게 해결하지⁉

  부분 종속에 해당하는 **결정자와 종속자를 별도의 테이블로 분리**시켜야 한다. 예시에서는 {stu_id, title, grade}, {stu_id, dept_name, office}로 분리시키면 된다.

  <br>

  ✔ 테이블 R에서 키가 아닌 모든 필드가 키에 대해 함수적으로 종속되며, 키의 부분집합이 결정자가 되는 **부분 종속이 존재하지 않으면**, R은 2차 정규형이다. 즉, 하나의 필드로 키가 정의되는 경우는 모두 2차 정규형이다.



- #### 3차 정규형

  2차 정규형은 이행적 함수 종속에 의해 이상현상이 발생한다.

  <br>

  📌 예시 테이블 {stu_id, dept_name, office} 기본키: stu_id

  - 삽입 이상: '물리학과'의 사무실이 '903호'라는 정보를 삽입하려고 할 때, 소속하는 학생이 존재하지 않으면 삽입이 불가능하다.
  - 삭제 이상: 학번이 '1292'인 학생의 정보를 삭제할 때, 그 학생이 '산업공학과'의 유일한 학생이라면 '산업공학과'의 정보도 삭제된다.
  - 수정 이상: '컴퓨터공학과'의 사무실 정보를 바꾸면, 이를 모든 레코드에 대해서 반영해야 한다.

  <br>

  🤷‍♀️ 이런 문제가 발생하는 이유❓

  **이행적 함수적 종속**이 발생했기 때문이다. 예시의 경우 office는 dept_name에 종속되고, 다시 dept_name은 stu_id에 종속된다.   따라서 office는 stu_id에 의해 이행 종속된다.

  <br>

  🙋‍♀️그러면 어떻게 해결하지⁉

  **이행종속에 해당하는 부분을 분리**해야 한다. 예시의 경우 {stu_id, dept_name}, {stu_id, office}로 분리하면 된다.

  <br>

  ✔ 테이블 R이 2차 정규형이면서 키에 속하지 않은 모든 필드가 기본키에 이행 종속되지 않는다면, R은 3차 정규형이다.



- #### BCNF형 정규형

  3차 정규형은 함수적 종속에서 결정자가 후보키가 아니라면 이상현상이 발생한다.

  <br>

  📌 예시 테이블 {stu_id, title, prof_name} 

  각 학생은 여러 교과목을 수강할 수 있고 각 교과목에 대해 학생은 한 명의 교수에 의해 강의를 받는다. 또한 각 교수는 하나의 과목만을 강의하지만, 하나의 과목은 여러 교수가 담당할 수 있다. 따라서 이 테이블의 후보키는 (stu_id, title), (stu_id, prof_name)

  - 삽입 이상: '홍길동' 교수가 '자료구조'를 강의한다는 사실을 삽입하고 싶을 때, 수강생이 한 명도 결정되지 않으면 삽입이 불가하다.
  - 삭제 이상: 학번이 '1292'인 학생이 '운영체제'를 수강한다는 데이터를 삭제한다고 했을 때, 이 학생이 '운영체제'를 듣는 유일한 수강생이라면 교수의 정보도 함께 삭제된다.
  - 수정 이상: '박철재' 교수가 '데이터베이스' 대신 '운영체제'를 강의하게 된다면, '박철재' 교수에 관한 모든 레코드를 변경해 줘야 한다.

  <br>

  🤷‍♀️ 이런 문제가 발생하는 이유❓

  함수적 종속에서 결정자가 후보키가 아니기 때문이다.

  <br>

  🙋‍♀️그러면 어떻게 해결하지⁉

  데이터 중복을 유발시키는 **함수적 종속성 정보를 별도의 테이블로 분해**하면 문제를 해결할 수 있다. 예시의 경우 {stu_id, prof_name}, {title, prof_name}로 분리하면 된다.

  <br>

  ✔ 테이블 R에 존재하는 모든 함수적 종속에서 결정자가 후보키이면,  R은 보이스-코드 정규형(BCNF)이다.