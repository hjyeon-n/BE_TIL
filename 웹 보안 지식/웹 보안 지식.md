# 웹 보안 지식 ✍

## HTTPS 🙆‍♀️

HTTP는 Hypertext Transfer Protocol의 약자다. 즉 Hypertext 인 HTML을 전송하기 위한 통신규약을 의미한다. **HTTPS에서 마지막의 S는 Over Secure Socket Layer의 약자**로 Secure라는 말을 통해서 알 수 있듯이 **보안이 강화된 HTTP**라는 것을 짐작할 수 있다. 

HTTP는 암호화되지 않은 방법으로 데이터를 전송하기 때문에 서버와 클라이언트가 주고 받는 메시지를 감청하는 것이 매우 쉽다. 예를 들어 로그인을 위해서 서버로 비밀번호를 전송하거나, 또는 중요한 기밀 문서를 열람하는 과정에서 악의적인 감청이나 데이터의 변조등이 일어날 수 있다. 이를 보안한 것이 바로 HTTPS다.

<br>

### 흠... HTTPS 정말 많이 써? 🤔

크롬 브라우저에서는 2017년부터 HTTPS를 권장하기 시작했다. HTTP를 사용하는 사이트에는 '안전하지 않은 사이트', HTTPS를 사용하는 사이트에서는 자물쇠 모양의 아이콘과 '안전한 사이트'라고 표시하고 있으며 자물쇠를 클릭하면 인증서도 함께 확인할 수 있다. 네이버와 다음 등의 포털 사이트에서도 HTTPS를 사용 중!😎

<br>

### HTTPS 통신 흐름 💨

1. 애플리케이션 서버(A)를 만드는 기업은 HTTPS를 적용하기 위해 공개키와 개인키를 만든다.
2. 신뢰할 수 있는 CA 기업을 선택하고, 그 기업에게 내 공개키 관리를 부탁하며 계약을 한다.
3. 계약 완료된 CA 기업은 해당 기업의 이름, A서버 공개키, 공개키 암호화 방법을 담은 인증서를 만들고 해당 인증서를 CA 기업의 개인키로 암호화해서 A서버에게 제공한다.
4. A서버는 암호화된 인증서를 갖게 되었다. 이제 A서버는 A서버의 공개키로 암호화된 HTTPS 요청이 아닌 요청이 오면, 이 암호화된 인증서를 클라이언트에게 건내준다.
5. 클라이언트는 `main.html` 파일을 달라고 A서버에 요청했다고 가정하자. HTTPS 요청이 아니기 때문에 CA기업이 A서버의 정보를 CA 기업의 개인키로 암호화한 인증서를 받게 된다.

> CA 기업의 공개키는 브라우저가 이미 알고있다. (세계적으로 신뢰할 수 있는 기업으로 등록되어 있기 때문에, 브라우저가 인증서를 탐색하여 해독이 가능한 것)

6. 브라우저는 해독한 뒤,  A서버의 공개키를 얻게 되었다. 이제 A서버와 통신할 때는 얻은 A서버의 공개키로 암호화해서 요청을 날리게 된다.

<br>

<br>

## SSL/TLS 🐱‍🏍

![image](https://user-images.githubusercontent.com/62419307/90326463-9e8ed900-dfc3-11ea-9a8a-3b446d6d7797.png)

<br>

**SSL(Secure Sockets Layer)**은 웹 서버와 브라우저 간에 암호화된 링크를 만드는 표준 보안 기술이다. 넷스케이프가 개발한 이 기술을 국제인터넷표준화기구(IETF)가 표준화하여 전송 계층 보안 **TLS(Transport Layer Security)**를 만들었다. 이 기술은 웹 서버와 브라우저 간에 전달되는 모든 데이터를 비밀로 만든다.

**SSL 인증서**는 클라이언트와 서버간의 통신을 제3자가 보증해주는 전자화된 문서다. 클라이언트가 서버에 접속한 직후에 서버는 클라이언트에게 이 인증서 정보를 전달한다. 클라이언트는 이 인증서 정보가 신뢰할 수 있는 지를 검증 한 후에 다음 절차를 수행하게 된다. SSL과 SSL 디지털 인증서를 이용했을 때의 이점은 아래와 같다.

- 통신 내용이 공격자에게 노출되는 것을 막을 수 있다. 
- 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서버인지를 판단할 수 있다.
- 통신 내용의 악의적인 변경을 방지할 수 있다. 

<br>

### SSL에서 사용하는 암호화의 종류 ✅

- #### 대칭키 (Symmetric Key)

  ✔ 암호화와 복호화에 같은 암호키(대칭키)를 사용하는 알고리즘

  - 동일한 키를 주고받기 때문에, 매우 빠르다는 장점이 있다.
  - 대칭키 전달과정에서 해킹 위험에 노출될 수 있다.

- #### 공개키 (Public Key)

  ✔ 암호화와 복호화에 사용하는 암호키를 분리한 알고리즘

  - 자신이 가지고 있는 고유한 암호키(비밀키)로만 복호화할 수 있는 암호키(공개키)를 대중에 공개한다.
  - 기밀성: 누군가가 중간에 데이터를 가로채더라도 수신자의 개인키로만 복호화할 수 있기 때문에 읽을 수 없다.
  - 부인 방지: 발신자의 개인키로 암호화된 데이터는 발신자의 공개키로만 복호화할 수 있다.

  <br>

  **공개키 암호화 방식 진행 과정**

  1. A가 웹 상에 공개된 'B의 공개키'를 이용해 평문을 암호화하여 B에게 보냄
  2. B는 자신의 비밀키로 복호화한 평문을 확인, A의 공개키로 응답을 암호화하여 A에게 보냄
  3. A는 자신의 비밀키로 암호화된 응답문을 복호화함

<br>

### SSL 인증서 용어 🔊

#### CA

인증서의 역할은 클라이언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지를 보장하는 역할을 한다. 이 역할을 하는 민간기업들이 있는데 이런 기업들을 CA(Certificate authority) 혹은 Root Certificate 라고 부른다. 

<br>

#### 사설 인증기관

개발이나 사적인 목적을 위해서 SSL의 암호화 기능을 이용하려한다면 자신이 직접 CA의 역할을 할 수도 있다. 물론 이것은 공인된 인증서가 아니기 때문에 이러한 사설 CA의 인증서를 이용하는 경우 브라우저는 경고를 출력한다.

<br>

### **SSL 인증서의 내용** 🔐

인증서의 내용은 위의 목적을 달성하기 위한 정보들이 있다.

예를 들면,

- **인증서를 발급한 기관**
- **서비스를 제공하는 도메인**
- 클라이언트가 접속하려는 서버의 **공개키**
- **공개키의 암호화 방법**

<br>

<br>

## CORS (Cross-Origin Resource Sharing) 🙊

추가 HTTP 헤더를 사용하여, 한 출처에서 실행 중인 웹 애플리케이션이 다른 출처의 선택한 자원에 접근할 수 있는 권한을 부여하도록 브라우저에 알려주는 체제다. 즉, 다른 출처 간의 리소스 공유를 막는 것을 말한다.

<br>

### 엥? 출처(Origin)가 뭐지? 🙄

서버의 위치를 의미하는 `https://google.com`과 같은 URL들은 마치 하나의 문자열 같아 보여도, 사실은 여러 개의 구성 요소로 이루어져있다.

![image](https://user-images.githubusercontent.com/62419307/90326743-f11dc480-dfc6-11ea-82be-7cf03c6936a4.png)

이때 출처는 `Protocol`과 `Host`, 그리고 위 그림에는 나와있지 않지만 `:80`, `:443`과 같은 포트 번호까지 모두 합친 것을 의미한다. 즉, 서버의 위치를 찾아가기 위해 필요한 가장 기본적인 것들을 합쳐놓은 것이다.

<br>

### 그러면 왜 CORS가 필요하지? 🤨

웹에서 돌아가는 클라이언트 어플리케이션은 사용자의 공격에 너무나도 취약한 구조를 가지고 있다. 이런 상황 속에서 다른 출처의 어플리케이션이 서로 통신하는 것에 대해 아무런 제약도 존재하지 않는다면, 악의를 가진 사용자가 소스 코드를 쓱 구경한 후 CSRF(Cross-Site Request Forgery나 XSS(Cross-Site Scripting)와 같은 방법을 사용하여 어플리케이션에서 코드가 실행된 것처럼 꾸며서 사용자의 정보를 탈취하기가 너무나도 쉬워진다. 

<br>

### 어떻게 해결하지? 😵

두 개의 출처가 서로 같다고 판단하는 로직 자체는 간단하기 때문에, 두 URL의 구성 요소 중 `Scheme`, `Host`, `Port`, 이 3가지만 동일하면 된다.

<br>

<br>

## 컨텐츠 보안 정책 (Content Security Policy) 🤓

**컨텐츠 보안 정책**(Content Security Policy, CSP)은 신뢰된 웹 페이지 컨텍스트에서 악의적인 컨텐츠를 실행하게 하는 사이트 간 스크립팅(XSS), 클릭재킹, 그리고 기타 코드 인젝션 공격을 예방하기 위해 도입된 컴퓨터 보안 표준이다. 웹 애플리케이션 보안의 W3C 워킹 그룹의 후보 권고안이며 현대 웹 브라우저에 폭넓게 지원된다.

➕ 용어 정리

+ XSS(Cross Site Scripting): 공격자에 의해 작성된 스크립트가 다른 사용자에게 전달되는 것을 말함. 다른 사용자의 웹 브라우저 내에서 적절한 검증 없이 실행되기 때문에 사용자의 세션을 탈취하거나, 웹 사이트를 변조하거나 혹은 악의적인 사이트로 사용자를 이동시킬 수 있다.
+ 클릭재킹(Clickjacking): 웹 사용자가 자신이 클릭하고 있다고 인지하는 것과 다른 어떤 것을 클릭하게 속이는 악의적인 기법으로써 잠재적으로 공격자는 비밀 정보를 유출시키거나 그들의 컴퓨터에 대한 제어를 획득할 수 있게 된다.

<br>

[참고1](https://suhak.tistory.com/738)

[참고2]([https://gyoogle.dev/blog/computer-science/network/HTTP%20&%20HTTPS.html](https://gyoogle.dev/blog/computer-science/network/HTTP & HTTPS.html))

[참고3](https://victorydntmd.tistory.com/95)

[참고4](https://evan-moon.github.io/2020/05/21/about-cors/)

[참고5](https://developer.mozilla.org/ko/docs/Web/HTTP/CORS)